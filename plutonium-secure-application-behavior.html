<script>
    'use strict';

    window.PlutoniumBehaviors = window.PlutoniumBehaviors || {};
    PlutoniumBehaviors.SecureApplicationBehavior = {
        properties: {
            session: {
                type: Object,
                notify: true,
                value: null
            },
            registering: {
                type: Boolean,
                notify: true,
                value: false
            }
        },
        observers: [
            'observeSession(session,registering)'
        ],
        listeners: {
            'unauthorized': 'onUnauthorized',
            'authorized': 'onAuthorized',
            'login': 'onLogin',
            'registrate': 'onRegistration',
            'passwordreset': 'onPasswordReset',
            'forgottenpassword': 'onForgottenPassword'
        },
        observeSession: function (session, registering) {
            if (!session && !registering) {
                this.$.loginWidget.open();
            } else if (!session && registering) {
                this.$.logonWidget.open();
            } else {
                this.$.loginWidget.close();
                this.$.logonWidget.close();
            }
        },
        onLogin: function (event, detail) {
            this.$.loginWidget.open();
        },
        onRegistration: function (event, detail) {
            this.$.logonWidget.open();
        },
        onPasswordReset: function (event, detail) {
            this.$.passwordResetWidget.open();
        },
        onForgottenPassword: function (event, detail) {
            this.$.forgottenPasswordWidget.open();
        },
        onUnauthorized: function (event, detail) {
            this.$.mainToast.text = detail.message;
            this.$.mainToast.show();
            this.observeSession(this.session, this.registering);
        },
        onAuthorized: function (event, detail) {
            this.$.mainToast.text = detail.message;
            this.$.mainToast.show();
            this.session = detail;
        }
    };
</script>